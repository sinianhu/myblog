(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{568:function(t,a,e){"use strict";e.r(a);var s=e(12),r=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"事件脉络"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#事件脉络"}},[t._v("#")]),t._v(" 事件脉络")]),t._v(" "),e("h2",{attrs:{id:"一、使用jdk自带jvisualvm-exe工具进行远程项目内存监控"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、使用jdk自带jvisualvm-exe工具进行远程项目内存监控"}},[t._v("#")]),t._v(" 一、使用jdk自带jvisualvm.exe工具进行远程项目内存监控")]),t._v(" "),e("p",[t._v("配置参考：\n"),e("a",{attrs:{href:"http://t.zoukankan.com/JimmyThomas-p-12123711.html",target:"_blank"}},[t._v("jvisualvm监控远程jvm的两种连接方式")]),e("br"),t._v("\n此处本人使用第二种JSTATD的方式，第一种jmx方式尝试几次后失败，留待以后进行尝试")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("创建 XXX.policy文件\njdk 1.8发布包中包括一个jstatd程序，使用jstatd需要指定一个policy文件，文件的后缀为 .policy,\n比如：jstatd-all.policy的文件，\n内容为：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[t._v(' \tgrant codebase "file:/usr/java/jdk1.8.0_212/lib/tools.jar" {\n \t\tpermission java.security.AllPermission;\n \t};\n')])])]),e("p",[t._v("或者")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[t._v(' \tgrant codebase "file:${java.home}/../lib/tools.jar" {\n \t\tpermission java.security.AllPermission;\n \t};\n')])])]),e("p",[t._v("2.启动")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[t._v(" \t./jstatd -J-Djava.security.policy=jstatd-all.policy &\n")])])]),e("p",[t._v("或者指定端口")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[t._v(" \t./jstatd -J-Djava.security.policy=jstatd-all.policy -p 9016 &\n")])])]),e("p",[t._v("3.在本地进行监控，推荐安装：工具-插件-Visual GC插件进行监控")])])]),t._v(" "),e("h2",{attrs:{id:"二、使用jvisualvm进行监控后发现项目异常"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、使用jvisualvm进行监控后发现项目异常"}},[t._v("#")]),t._v(" 二、使用jvisualvm进行监控后发现项目异常")]),t._v(" "),e("p",[t._v("异常问题：YGC频繁、新生代Eden区会在迅速变满-YGC清空之间循环，因为S0,S1代并没有随着YGC使用量波动变大\n故认定存在异常线程导致频繁触发YGC")]),t._v(" "),e("h2",{attrs:{id:"三、异常线程定位"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三、异常线程定位"}},[t._v("#")]),t._v(" 三、异常线程定位")]),t._v(" "),e("p",[t._v("参考文档："),e("a",{attrs:{href:"https://blog.csdn.net/ocean73737/article/details/78212663?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1-78212663-blog-122377202.pc_relevant_multi_platform_featuressortv2dupreplace&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1-78212663-blog-122377202.pc_relevant_multi_platform_featuressortv2dupreplace&utm_relevant_index=1",target:"_blank"}},[t._v("jstack 命令跟踪 java 应用的堆栈 并分析堆栈结果")]),e("br"),t._v("\n简述步骤与相关命令：")]),t._v(" "),e("ol",[e("li",[t._v("找到项目进程id  55536")])]),t._v(" "),e("div",{staticClass:"language-linux line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@dev-h3-test]$ ps -ef|grep java\nroot      55536     1  3 09:45 ?        00:01:55 ../../jdk1.8.0_171/bin/java -Djava.util.lo...\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[t._v("根据进程ID定位此进程中cpu耗时最多的线程")])]),t._v(" "),e("div",{staticClass:"language-linux line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[root@dev-h3-test]$ top Hp55536\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[t._v("根据结果中的TIME+列定位到线程ID 55625\n")])])]),e("ol",{attrs:{start:"3"}},[e("li",[t._v("将线程ID装换位16进制，此处可使用命令，也可使用外部工具，命令如下")])]),t._v(" "),e("div",{staticClass:"language-linux line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('[root@dev-h3-test]$ printf "%x\\n" 55625\nd949  --\x3e16进制线程ID\n')])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br")])]),e("ol",{attrs:{start:"4"}},[e("li",[t._v("根据16进制线程ID在jstack中打印堆栈信息（55536进程ID，d949线程16进制ID）")])]),t._v(" "),e("div",{staticClass:"language-linux line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('[root@dev-h3-test]$ jstack 55536 | grep d949\n"ContainerBackgroundProcessor[StandardEngine[Catalina]]" #29 daemon prio=5 os_prio=0 tid=0x00007f8b941b9000 nid=0xd949 waiting on condition [0x00007f8b5cd7b000]\n')])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br")])]),e("ol",{attrs:{start:"5"}},[e("li",[t._v("结果\n根据结果可以看到cpu耗时最长的线程为：ContainerBackgroundProcessor[StandardEngine[Catalina]]")])]),t._v(" "),e("h2",{attrs:{id:"四、问题解决"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四、问题解决"}},[t._v("#")]),t._v(" 四、问题解决")]),t._v(" "),e("p",[t._v("经过查询根据文章"),e("a",{attrs:{href:"https://blog.csdn.net/loophome/article/details/100693030",target:"_blank"}},[t._v("《记一次tomcat程序CPU占用高排查-backgroundProcessorDelay参数》")]),e("br"),t._v("\n定位此进程为tomcat守护进程，Tomcat的Engine会启动一个线程（就是ContainerBackgroundProcessor），该线程每10s会发送一个发送一个事件，监听到该事件的部署配置类会自动去扫描webapp文件夹下的war包，将其加载成一个Context，即启动一个web服务。同时，该线程还会调用子容器Engine、Host、Context、Wrapper各容器组件及与它们相关的其它组件的backgroundProcess方法。"),e("br"),t._v("\n解决方法为在tomcat的server.xml的engine增加属性backgroundProcessorDelay(默认为10)，设置为900")]),t._v(" "),e("div",{staticClass:"language-linux line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('<Engine name="Catalina" defaultHost="localhost" backgroundProcessorDelay="900">\n')])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("重启tomcat项目后YGC频繁问题解决！\nPS:此处附录tomcat的server.xml engine属性清单")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("属性")]),t._v(" "),e("th",[t._v("描述")]),t._v(" "),e("th",[t._v("默认值")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("backgroundProcessorDelay")]),t._v(" "),e("td",[t._v("当前Engine及其子容器backgroundProcessor方法执行的延迟时间，包括所有Host和Context，单位s。如果子容器属性backgroundProcessorDelay的取值为非负数，将不执行。属性为正数时，tomcat将会创建一个后台线程，等待执行时间后，该线程将执行当前Engine及其所有子容器的backgroundProcessorDelay方法")]),t._v(" "),e("td",[t._v("10")])]),t._v(" "),e("tr",[e("td",[t._v("className")]),t._v(" "),e("td",[t._v("实例化Engine时使用的类名。指定类必须实现org.apache.catalina.Engine接口。不指定则使用org.apache.catalina.core.StandardEngine")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("defaultHost")]),t._v(" "),e("td",[t._v("默认Host名称，当根据请求无法找到host时，使用默认Host处理")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("jvmRoute")]),t._v(" "),e("td",[t._v("用于在负载均衡场景下启用粘性会话，该标识在整个集群所有tomcat中唯一，而且会附加到生成的会话标识符。通过此值，前端代理可以将某个会话定向到同一个Tomcat实例")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("name")]),t._v(" "),e("td",[t._v("Engine的逻辑名称。当同一个server中存在多个service时，engine名必须唯一")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("startStopThreads")]),t._v(" "),e("td",[t._v("Engine用于启动Host的线程数。如果设置为0，将使用Runtime.getRuntime().availableProcessors()的值。如果设置为负值，则使用Runtime.getRuntime().availableProcessors()+startStopThreads，如果设置结果小于1，取值为1")]),t._v(" "),e("td",[t._v("1")])])])]),t._v(" "),e("h2",{attrs:{id:"五、参考文档"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#五、参考文档"}},[t._v("#")]),t._v(" 五、参考文档：")]),t._v(" "),e("ol",[e("li",[t._v("本地监控远程java内存："),e("a",{attrs:{href:"http://t.zoukankan.com/JimmyThomas-p-12123711.html",target:"_blank"}},[t._v("《jvisualvm监控远程jvm的两种连接方式》")])]),t._v(" "),e("li",[t._v("linux定位java执行异常线程："),e("a",{attrs:{href:"https://blog.csdn.net/ocean73737/article/details/78212663?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1-78212663-blog-122377202.pc_relevant_multi_platform_featuressortv2dupreplace&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1-78212663-blog-122377202.pc_relevant_multi_platform_featuressortv2dupreplace&utm_relevant_index=1",target:"_blank"}},[t._v("《jstack 命令跟踪 java 应用的堆栈 并分析堆栈结果》")])]),t._v(" "),e("li",[t._v("相同问题场景："),e("a",{attrs:{href:"https://blog.csdn.net/loophome/article/details/100693030",target:"_blank"}},[t._v("《记一次tomcat程序CPU占用高排查-backgroundProcessorDelay参数》")])]),t._v(" "),e("li",[t._v("tomcat server.xml 配置参数："),e("a",{attrs:{href:"https://www.cnblogs.com/zh-dream/p/13621743.html",target:"_blank"}},[t._v("tomcat server.xml配置属性")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);